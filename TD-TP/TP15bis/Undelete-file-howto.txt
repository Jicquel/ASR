JICQUEL VINCENT GROUPE 4

ils -r 0image.ext3

st_ino|st_alloc|st_uid|st_gid|st_mtime|st_atime|st_ctime|st_crtime|st_mode|st_nlink|st_size
30|f|1000|100|1423447732|1423447393|1423447732|0|644|0|0

On obtient l'inode supprimé : 30.

dumpe2fs indique que la table d'inodes commence au bloc 20.

On divise donc le numéro d'inode par le nombre d'inode dans un bloc (8) 30/8 = 3.
donc on va dans le bloc 20 + 3 = 23 du journal, décalé de (30%8 -1 )*taille d'un inode = 6*128 avec jcat

Avec jls 0image.ext3 | grep 23, on obtient tous les blocs du journal qui contiennent des transactions concernant le bloc 23

4:  Unallocated FS Block 23
20: Unallocated FS Block 23
23: Unallocated Commit Block (seq: 26, sec: 0.0)
27: Unallocated FS Block 23
113:  Unallocated FS Block 23
122:  Unallocated FS Block 23
123:  Unallocated FS Block 1683
129:  Unallocated FS Block 23
138:  Unallocated FS Block 23

jcat 0image.ext3 20 |dd bs=128 skip=5 count=1 |xxd
1+0 records in
1+0 records out
00000000: a481 e803 3b57 0400 6115 d854 6115 d854  ....;W..a..Ta..T
128 bytes copied, 0.00213328 s, 60.0 kB/s00000010: 6115 d854 0000 0000 6400 0100 3202 0000  a..T....d...2...

00000020: 0000 0000 0000 0000 9b06 0000 9c06 0000  ................
00000030: 9d06 0000 9e06 0000 9f06 0000 a006 0000  ................
00000040: a106 0000 a206 0000 a306 0000 a406 0000  ................
00000050: a506 0000 a606 0000 a706 0000 a807 0000  ................
00000060: 0000 0000 8596 cda3 0000 0000 0000 0000  ................
00000070: 0000 0000 0000 0000 0000 0000 0000 0000  ................

Le fichier fait 0x0004563b bytes, donc 284219 octets, donc 277 Ko.
On décale de 40 octets pour atteindre les i_block.
Donc, on obtient les blocs 0x0000069b, 0x0000069c,0x0000069d, 0x0000069e, 0x0000069f, 0x000006a0, 0x000006a1,
  0x000006a2, 0x000006a3, 0x000006a4, 0x000006a5, 0x000006a6 en direct, 0x000006a7 en indirect, 0x0000a807 en double indirect.

0x000069b = 1691, il y a 12 blocs directs.
dd bs=1024 skip=1690 count=12 of=part1 if=0image.ext3

On fait ensuite un bd 1703 car (0x00006a7 = 1703), puis on copie de la même maniere tous les contenus des blocs avec

debugfs:  bd 1703
0000  a806 0000 a906 0000 aa06 0000 ab06 0000  ................
0020  ac06 0000 ad06 0000 ae06 0000 af06 0000  ................
0040  b006 0000 b106 0000 b206 0000 b306 0000  ................
0060  b406 0000 b506 0000 b606 0000 b706 0000  ................
0100  b806 0000 b906 0000 ba06 0000 bb06 0000  ................
0120  bc06 0000 bd06 0000 be06 0000 bf06 0000  ................
0140  c006 0000 c106 0000 c206 0000 c306 0000  ................
0160  c406 0000 c506 0000 c606 0000 c706 0000  ................
0200  c806 0000 c906 0000 ca06 0000 cb06 0000  ................
0220  cc06 0000 cd06 0000 ce06 0000 cf06 0000  ................
0240  d006 0000 d106 0000 d206 0000 d306 0000  ................
0260  d406 0000 d506 0000 d606 0000 d706 0000  ................
0300  d806 0000 d906 0000 da06 0000 db06 0000  ................
0320  dc06 0000 dd06 0000 de06 0000 df06 0000  ................
0340  e006 0000 e106 0000 e206 0000 e306 0000  ................
0360  e406 0000 e506 0000 e606 0000 e706 0000  ................
0400  e806 0000 e906 0000 ea06 0000 eb06 0000  ................
0420  ec06 0000 ed06 0000 ee06 0000 ef06 0000  ................
0440  f006 0000 f106 0000 f206 0000 f306 0000  ................
0460  f406 0000 f506 0000 f606 0000 f706 0000  ................
0500  f806 0000 f906 0000 fa06 0000 fb06 0000  ................
0520  fc06 0000 fd06 0000 fe06 0000 ff06 0000  ................
0540  0007 0000 0107 0000 0207 0000 0307 0000  ................
0560  0407 0000 0507 0000 0607 0000 0707 0000  ................
0600  0807 0000 0907 0000 0a07 0000 0b07 0000  ................
0620  0c07 0000 0d07 0000 0e07 0000 0f07 0000  ................
0640  1007 0000 1107 0000 1207 0000 1307 0000  ................
0660  1407 0000 1507 0000 1607 0000 1707 0000  ................
0700  1807 0000 1907 0000 1a07 0000 1b07 0000  ................
0720  1c07 0000 1d07 0000 1e07 0000 1f07 0000  ................
0740  2007 0000 2107 0000 2207 0000 2307 0000   ...!..."...#...
0760  2407 0000 2507 0000 2607 0000 2707 0000  $...%...&...'...
1000  2807 0000 2907 0000 2a07 0000 2b07 0000  (...)...*...+...
1020  2c07 0000 2d07 0000 2e07 0000 2f07 0000  ,...-......./...
1040  3007 0000 3107 0000 3207 0000 3307 0000  0...1...2...3...
1060  3407 0000 3507 0000 3607 0000 3707 0000  4...5...6...7...
1100  3807 0000 3907 0000 3a07 0000 3b07 0000  8...9...:...;...
1120  3c07 0000 3d07 0000 3e07 0000 3f07 0000  <...=...>...?...
1140  4007 0000 4107 0000 4207 0000 4307 0000  @...A...B...C...
1160  4407 0000 4507 0000 4607 0000 4707 0000  D...E...F...G...
1200  4807 0000 4907 0000 4a07 0000 4b07 0000  H...I...J...K...
1220  4c07 0000 4d07 0000 4e07 0000 4f07 0000  L...M...N...O...
1240  5007 0000 5107 0000 5207 0000 5307 0000  P...Q...R...S...
1260  5407 0000 5507 0000 5607 0000 5707 0000  T...U...V...W...
1300  5807 0000 5907 0000 5a07 0000 5b07 0000  X...Y...Z...[...
1320  5c07 0000 5d07 0000 5e07 0000 5f07 0000  \...]...^..._...
1340  6007 0000 6107 0000 6207 0000 6307 0000  `...a...b...c...
1360  6407 0000 6507 0000 6607 0000 6707 0000  d...e...f...g...
1400  6807 0000 6907 0000 6a07 0000 6b07 0000  h...i...j...k...
1420  6c07 0000 6d07 0000 6e07 0000 6f07 0000  l...m...n...o...
1440  7007 0000 7107 0000 7207 0000 7307 0000  p...q...r...s...
1460  7407 0000 7507 0000 7607 0000 7707 0000  t...u...v...w...
1500  7807 0000 7907 0000 7a07 0000 7b07 0000  x...y...z...{...
1520  7c07 0000 7d07 0000 7e07 0000 7f07 0000  |...}...~.......
1540  8007 0000 8107 0000 8207 0000 8307 0000  ................
1560  8407 0000 8507 0000 8607 0000 8707 0000  ................
1600  8807 0000 8907 0000 8a07 0000 8b07 0000  ................
1620  8c07 0000 8d07 0000 8e07 0000 8f07 0000  ................
1640  9007 0000 9107 0000 9207 0000 9307 0000  ................
1660  9407 0000 9507 0000 9607 0000 9707 0000  ................
1700  9807 0000 9907 0000 9a07 0000 9b07 0000  ................
1720  9c07 0000 9d07 0000 9e07 0000 9f07 0000  ................
1740  a007 0000 a107 0000 a207 0000 a307 0000  ................
1760  a407 0000 a507 0000 a607 0000 a707 0000  ................

0x06a8 = 1704, il y a 1024/4 = 256 blocs de données, donc

dd bs=1024 skip=1703 count=256 of=part2 if=0image.ext3

Ensuite, on part dans le double indirect, et on obtient 
[jicquelv@salle229-02 TP15bis]$ debugfs 0image.ext3
debugfs 1.42.13 (17-May-2015)
  debugfs:  bd 1960
  0000  a907 0000 0000 0000 0000 0000 0000 0000  ................
  0020  0000 0000 0000 0000 0000 0000 0000 0000  ................

  donc 
  debugfs:  bd 1961
  0000  aa07 0000 ab07 0000 ac07 0000 ad07 0000  ................
  0020  ae07 0000 af07 0000 b007 0000 b107 0000  ................
  0040  b207 0000 b307 0000 0000 0000 0000 0000  ................
  0060  0000 0000 0000 0000 0000 0000 0000 0000  ................

  on fait ensuite un 
dd bs=1024 skip=1961 count=256 of=part3 if=0image.ext3

car 0x07aa = 1962,

puis on cat part1 part2 part3 > img

